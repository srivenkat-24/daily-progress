<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Daily Progress</title>

<style>
* {
  box-sizing: border-box;
  -webkit-tap-highlight-color: transparent;
}

body {
  margin:0;
  font-family: system-ui, sans-serif;
  background:#f4f6f8;
  overscroll-behavior: contain;
}

/* Pages */
.page {
  min-height:100dvh;
  display:none;
  align-items:center;
  justify-content:center;
  padding:12px;
}
.page.active{display:flex;}

/* Card */
.card{
  width:100%;
  max-width:420px;
  background:#fff;
  padding:20px;
  border-radius:16px;
  box-shadow:0 12px 30px rgba(0,0,0,.12);
  position:relative;
}

/* Goals */
.goal-list{
  max-height:180px;
  overflow-y:auto;
  border:1px solid #eee;
  border-radius:10px;
  padding:10px;
  margin-bottom:12px;
}

.goal-input{
  display:flex;
  gap:8px;
}
.goal-input input{
  flex:1;
  padding:12px;
  font-size:16px;
}
.goal-input button{
  min-width:44px;
  font-size:20px;
}

/* Buttons */
button,
.done-btn {
  min-height:44px;
  font-size:15px;
}

.done-btn{
  position:static;
  margin-top:16px;
  width:100%;
  background:#111;
  color:#fff;
  padding:14px;
  border-radius:30px;
  text-align:center;
  cursor:pointer;
}

/* Calendar */
.calendar{
  width:100%;
  display:grid;
  grid-template-columns:repeat(7,1fr);
  gap:8px;
  max-width:420px;
}

.day{
  background:#fff;
  padding:14px 0;
  border-radius:10px;
  text-align:center;
  cursor:pointer;
  font-size:14px;
  min-width:auto;
}

.day.red{background:#ffadad;}
.day.yellow{background:#ffe066;}
.day.green{background:#b7e4c7;}

/* Modal */
.modal{
  position:fixed;
  inset:0;
  background:rgba(0,0,0,.45);
  display:none;
  align-items:flex-end;
  justify-content:center;
  padding:0;
  z-index:20;
}

.modal-box{
  background:#fff;
  width:100%;
  max-width:500px;
  padding:20px;
  border-radius:20px 20px 0 0;
  max-height:90dvh;
  overflow-y:auto;
}

/* Status buttons */
.status-btn{
  width:44px;
  height:44px;
  border-radius:50%;
  border:none;
  cursor:pointer;
  margin-right:8px;
  position:relative;
}

.status-btn.selected::after{
  content:"âœ”";
  position:absolute;
  inset:0;
  display:flex;
  align-items:center;
  justify-content:center;
  font-size:16px;
}

/* Colors */
.red{background:#ff6b6b;}
.yellow{background:#ffd93d;}
.green{background:#6bcf63;}

/* Inputs */
.reason-box select,
.reason-box input{
  width:100%;
  margin-top:6px;
  padding:10px;
  font-size:14px;
}

/* Insights Button */
.insights-btn{
  position:fixed;
  bottom:16px;
  right:16px;
  padding:14px 20px;
  border-radius:50px;
  background:#111;
  color:#fff;
  cursor:pointer;
  font-weight:bold;
  font-size:15px;
  box-shadow:0 4px 12px rgba(0,0,0,.3);
  z-index:15;
}

.insights-btn.pulse{
  animation:pulse 1.6s infinite;
}

@keyframes pulse{
  0%{transform:scale(1);}
  50%{transform:scale(1.05);}
  100%{transform:scale(1);}
}

/* Canvas */
canvas{
  width:100%;
  height:auto;
  max-height:260px;
}

/* Small screens */
@media (max-width:420px){
  h3,h4{font-size:18px;}
  .calendar{gap:6px;}
  .day{font-size:13px;}
}
</style>
</head>

<body>

<!-- MONTHLY GOALS PAGE -->
<div id="goalsPage" class="page active">
  <div class="card">
    <h3>Set your goals for this month</h3>
    <div id="goalList" class="goal-list"></div>
    <div class="goal-input">
      <input id="goalInput" placeholder="Add a goal">
      <button onclick="addGoal()">+</button>
    </div>
    <div class="done-btn" onclick="finishSetup()">Done</div>
    <button id="startNewMonthBtn" class="insights-btn" onclick="startNewMonth()">Start New Month</button>
  </div>
</div>

<!-- CALENDAR PAGE -->
<div id="calendarPage" class="page">
  <div id="calendar" class="calendar"></div>
  <button id="insightsBtn" class="insights-btn" onclick="openInsights()">Insights</button>
</div>

<!-- DAY MODAL -->
<div id="dayModal" class="modal">
  <div class="modal-box">
    <h4 id="dayTitle"></h4>
    <div class="legend">ðŸ”´ &lt;50% &nbsp; ðŸŸ¡ &gt;50% &nbsp; ðŸŸ¢ 100%</div>
    <div id="goalRatings"></div>
    <hr>
    <p><strong>Overall day</strong></p>
    <div id="overallBtns">
      <button class="status-btn red" onclick="setOverall('red',this)"></button>
      <button class="status-btn yellow" onclick="setOverall('yellow',this)"></button>
      <button class="status-btn green" onclick="setOverall('green',this)"></button>
    </div>
    <br>
    <button onclick="saveDay()">Save</button>
  </div>
</div>

<!-- INSIGHTS MODAL -->
<div id="insightsModal" class="modal">
  <div class="modal-box">
    <h4>Insights</h4>
    <div id="insightButtons" style="margin-bottom:10px;"></div>
    <canvas id="insightChart"></canvas>
    <div id="insightLegend" class="insight-legend"></div>
    <div id="topReasons"></div>
    <br>
    <button onclick="closeInsights()">Close</button>
  </div>
</div>

<script>
/* ðŸ”’ EXACT JS YOU PROVIDED â€” UNTOUCHED */

const monthKey = new Date().toISOString().slice(0,7);
let goals = [];
let progress = JSON.parse(localStorage.getItem("progress_"+monthKey)) || {};
let currentDay = null;
let overallTemp = null;
const insightsBtn = document.getElementById("insightsBtn");

/* â¬‡ï¸ EVERYTHING BELOW IS COPY-PASTE FROM YOUR ORIGINAL FILE â¬‡ï¸ */

function addGoal() {
  const v = goalInput.value.trim();
  if(!v) return;
  goals.push(v);
  renderGoalList();
  goalInput.value="";
}
function renderGoalList() { goalList.innerHTML = goals.map(g=>`<div>â€¢ ${g}</div>`).join(""); }

function finishSetup() {
  if(!goals.length) return alert("Add goals");
  goalsPage.classList.remove("active");
  calendarPage.classList.add("active");
  renderCalendar();
  checkNewData();
}

function startNewMonth(){
  if(confirm("Start a new month? Old data will be cleared.")){
    localStorage.removeItem("progress_"+monthKey);
    progress={};
    goals=[];
    goalList.innerHTML="";
    calendar.innerHTML="";
    goalsPage.classList.add("active");
    calendarPage.classList.remove("active");
  }
}

function renderCalendar(){
  calendar.innerHTML="";
  const days = new Date(new Date().getFullYear(), new Date().getMonth()+1,0).getDate();
  for(let d=1;d<=days;d++){
    const status=progress[d]?.overall||"";
    calendar.innerHTML+=`<div class="day ${status}" onclick="openDay(${d})">${d}</div>`;
  }
  checkNewData();
}

function openDay(day){
  currentDay=day;
  overallTemp=progress[day]?.overall||null;
  if(!progress[day]) progress[day]={goals:{},overall:null};

  dayTitle.innerText=`Day ${day}`;
  goalRatings.innerHTML="";
  goals.forEach(goal=>{
    const data=progress[day].goals[goal]||{};
    const status=data.status||"";
    let buttons=["red","yellow","green"].map(c=>{
      return `<button class="status-btn ${c} ${status===c?"selected":""}" onclick="setGoal('${goal}','${c}',this)"></button>`;
    }).join("");
    goalRatings.innerHTML+=`
      <div>
        <strong>${goal}</strong><br>${buttons}
        <div class="reason-box" id="reason-${goal}">${status==="red"?reasonHTML(goal,data):""}</div>
      </div><br>`;
  });

  document.querySelectorAll("#overallBtns .status-btn").forEach(b=>b.classList.remove("selected"));
  if(overallTemp) document.querySelector(`#overallBtns .${overallTemp}`).classList.add("selected");

  dayModal.style.display="flex";
}

function reasonHTML(goal,data){
  return `<select onchange="setReason('${goal}',this.value)">
      <option value="">Reason</option>
      <option ${data.reason==="Procrastination"?"selected":""}>Procrastination</option>
      <option ${data.reason==="Tired"?"selected":""}>Tired</option>
      <option ${data.reason==="Urgent work"?"selected":""}>Urgent work</option>
      <option ${data.reason==="No interest"?"selected":""}>No interest</option>
      <option ${data.reason==="Other"?"selected":""}>Other</option>
    </select>
    <input placeholder="Optional note for Other" value="${data.note||""}" oninput="setNote('${goal}',this.value)">`;
}

function setGoal(goal,color,btn){
  progress[currentDay].goals[goal]={status:color};
  btn.parentNode.querySelectorAll(".status-btn").forEach(b=>b.classList.remove("selected"));
  btn.classList.add("selected");
  const box=document.getElementById(`reason-${goal}`);
  box.innerHTML=color==="red"?reasonHTML(goal,{}):"";
}

function setReason(goal,val){ progress[currentDay].goals[goal].reason=val; }
function setNote(goal,val){ progress[currentDay].goals[goal].note=val; }

function setOverall(color,btn){
  overallTemp=color;
  document.querySelectorAll("#overallBtns .status-btn").forEach(b=>b.classList.remove("selected"));
  btn.classList.add("selected");
}

function saveDay(){
  if(goals.some(g=>!progress[currentDay].goals[g])) return alert("Rate all goals");
  if(!overallTemp) return alert("Rate overall day");
  progress[currentDay].overall=overallTemp;
  localStorage.setItem("progress_"+monthKey, JSON.stringify(progress));
  dayModal.style.display="none";
  renderCalendar();
}

function openInsights(){
  insightsModal.style.display="flex";
  const btnDiv=document.getElementById("insightButtons");
  btnDiv.innerHTML="<button onclick='renderChart(\"overall\")'>Overall</button>";
  goals.forEach(g=> btnDiv.innerHTML+=`<button onclick='renderChart("${g}")'>${g}</button>`);
  renderChart("overall");
  insightsBtn.classList.remove("pulse");
}

function closeInsights(){ insightsModal.style.display="none"; }

function renderChart(target){
  const canvas=document.getElementById("insightChart");
  const ctx=canvas.getContext("2d");
  canvas.width = canvas.clientWidth;
  canvas.height = canvas.clientWidth * 0.6;
  ctx.clearRect(0,0,canvas.width,canvas.height);

  let counts={red:0,yellow:0,green:0};
  let reasonCounts={};

  if(target==="overall"){
    Object.values(progress).forEach(d=>{
      if(d.overall) counts[d.overall]++;
      Object.values(d.goals||{}).forEach(g=>{
        if(g.status==="red"){
          let reasonText = g.reason==="Other" && g.note ? g.note : g.reason;
          if(reasonText) reasonCounts[reasonText]=(reasonCounts[reasonText]||0)+1;
        }
      });
    });
  }else{
    Object.values(progress).forEach(d=>{
      if(d.goals[target] && d.goals[target].status==="red"){
        let g = d.goals[target];
        let reasonText = g.reason==="Other" && g.note ? g.note : g.reason;
        if(reasonText) reasonCounts[reasonText]=(reasonCounts[reasonText]||0)+1;
        counts[g.status]++;
      } else if(d.goals[target]){
        counts[d.goals[target].status]++;
      }
    });
  }

  const total=counts.red+counts.yellow+counts.green;
  if(total===0) return;

  const w=canvas.width,h=canvas.height;
  let start=0;
  ["red","yellow","green"].forEach(c=>{
    let val=counts[c]/total*2*Math.PI;
    ctx.fillStyle=c==="red"?"#ff6b6b":c==="yellow"?"#ffd93d":"#6bcf63";
    ctx.beginPath();
    ctx.moveTo(w/2,h/2);
    ctx.arc(w/2,h/2,Math.min(w,h)/2-10,start,start+val);
    ctx.closePath();
    ctx.fill();
    start+=val;
  });

  insightLegend.innerHTML=
    `<span style="background:#ff6b6b"></span> Red: ${counts.red} (${((counts.red/total)*100).toFixed(1)}%)
     <span style="background:#ffd93d"></span> Yellow: ${counts.yellow} (${((counts.yellow/total)*100).toFixed(1)}%)
     <span style="background:#6bcf63"></span> Green: ${counts.green} (${((counts.green/total)*100).toFixed(1)}%)`;

  const sorted=Object.entries(reasonCounts).sort((a,b)=>b[1]-a[1]);
  topReasons.innerHTML=sorted.length
    ? "<strong>Top reasons for Red:</strong><br>"+sorted.slice(0,3).map(r=>`${r[0]} (${r[1]})`).join("<br>")
    : "";
}

function checkNewData(){
  const anyRed = Object.values(progress).some(d =>
    Object.values(d.goals||{}).some(g => g.status==="red")
  );
  insightsBtn.classList.toggle("pulse", anyRed);
}

checkNewData();
</script>

</body>
</html>
